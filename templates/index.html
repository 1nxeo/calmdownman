<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
      crossorigin="anonymous"
    ></script>
    <link rel="shortcut icon" href="../static/img/logo.jpg" type="image/x-icon">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
    <link rel="stylesheet" href="../static/css/index.css" />
    <title>추천민수야 고마워!</title>
  </head>
  <body>
    <script>
      $(document).ready(function () {
        localStorage.getItem("login_token");

          listing();
      });

      function listing() {
        $.ajax({
          type: "GET",
          url: "/write/get",
          data: {},
          success: function (response) {
            let rows = response["write_get"];
            for (let i = 0; i < rows.length; i++) {
              let title = rows[i]["title"];
              let image = rows[i]["image"];
              let comment = rows[i]["comment"];
              let star = rows[i]["star"];
              let num = rows[i]["num"];
              let url = rows[i]["url"];
              let star_image = "⭐".repeat(star);

              let temp_html = `
                <div class="col" id="detailBox">
                  <div class="card h-100">
                    <a href="/detail/${num}" >
                        <img src="${image}" class="card-img-top" >
                        <div class="card-body">
                          <h5 class="card-title">${title}</h5>
                          <p>${star_image}</p>
                          <p class="mycomment">${comment}</p>
                        </div>
                      </div>
                    </a>
                  </div>
                </div>
              `;

              $("#cards-box").append(temp_html);
            }
          },
        });
      }
      $('#detailbox').on('click', function({num}){
        location.href = "/detail/" + num
      })

      function posting() {
        let url_p = $("#url").val();
        let comment_p = $("#comment").val();
        let star_p = $("#star").val();

        $.ajax({
          type: "POST",
          url: "/write/post",
          data: { url_give: url_p, comment_give: comment_p, star_give: star_p },
          success: function (response) {
            alert(response["msg"]);
            window.location.reload();
          },
        });
      }

      function open_box() {
        $("#post-box").show();
      }

      function close_box() {
        $("#post-box").hide();
      }

      function sign_out() {
          $.removeCookie('mytoken');
        alert("로그아웃!");
        window.location.href = "/";
      }
    </script>

    <!-- navbar -->
    <nav class="navbar navbar-expand-lg bg-light">
      <div class="container-md">
        <a href="/"
          ><img src="../static/img/logo.jpg" alt="로고이미지" width="200px"
        /></a>
          <a
          class="btn btn-outline-danger"
          aria-label="logout"
        >
          $('logined_user')
        </a>
        <a
          class="btn btn-outline-danger"
          aria-label="logout"
          onclick="sign_out()"
        >
          로그아웃
        </a>
      </div>
    </nav>
    <!-- header -->
    <div class="contents">
    <div class="idx_top">
      <strong
        >MY Favorite <br />
        Calmdownman</strong
      >
      <p>
        자신이 좋아하는 침착맨 유튜브<br />
        사이트를 추천해보세요!
      </p>
    </div>
    <!-- contents  -->
    <div class="btn-wrap">
      <button type="button" class="btn btn-outline-danger" onclick="open_box()">
        유튜브 링크 기록하기
      </button>
    </div>
    <div class="modal" tabindex="-1" id="post-box">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">링크를 올리고 별점과 평가를 남겨주세요!</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div class="form-floating mb-3">
              <input
                id="url"
                type="email"
                class="form-control"
                placeholder="name@example.com"
              />
              <label> 유튜브 링크 </label>
            </div>

            <div class="input-group mb-3">
              <label class="input-group-text" for="inputGroupSelect01"
                >별점</label
              >
              <select class="form-select" id="star">
                <option selected>-- 별점 --</option>
                <option value="1">⭐</option>
                <option value="2">⭐⭐</option>
                <option value="3">⭐⭐⭐</option>
                <option value="4">⭐⭐⭐⭐</option>
                <option value="5">⭐⭐⭐⭐⭐</option>
              </select>
            </div>

            <div class="form-floating">
              <textarea
                id="comment"
                class="form-control"
                placeholder="Leave a comment here"
              ></textarea>
              <label for="floatingTextarea2"> 평가 </label>
            </div>
          </div>
          <div class="modal-footer">
            <button onclick="posting()" type="button" class="btn btn-dark">
              기록하기
            </button>
            <button
              onclick="close_box()"
              type="button"
              class="btn btn-outline-dark"
            >
              닫기
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="mycards">
      <div class="row row-cols-1 row-cols-md-4 g-4" id="cards-box"></div>
    </div>
  </body>
</div>
</html>
